# Check the working Directory 
getwd()
setwd(".\\Malware_detection_Project")

#Downloading package
install.packages("ggplot2")
install.packages("dplyr")
install.packages("caTools")
install.packages("randomForest")
# Activating package
library(ggplot2)
library(caTools)
library(dplyr)
library(Amelia)
library(randomForest)
# Reading a data set
Malware <- read.csv("Kaggle-data.csv")

# Exploring the data - set
dim(Malware)
head(Malware)
tail(Malware)
str(Malware)
summary(Malware)


# create categorical variable 
distinct(select(Malware,legitimate))
Malware$legitimate <- factor(Malware$legitimate)
levels(Malware$legitimate)
# visualization 
ggplot(data = Malware,aes(x=legitimate)) + geom_bar(width=0.5,fill="blue",color="black",alpha=0.4)


# Data cleaning 
any(is.na(Malware))
Malware$X <- NULL
#head(Malware)
Malware[is.na(Malware)] <- 0
#removing unwanted column
Malware.rm <- select(Malware,-ID,-md5)
any(is.na(Malware.rm))
head(Malware.rm)
dim(Malware.rm)
#missmap (Malware.rm,main = "Missing Map",col = c('yellow','black'))



# Spliting the dataset 
set.seed(101)
sample <- sample.split(Malware.rm$legitimate,SplitRatio = 0.65)
Malware.train <- subset(Malware.rm,sample==T)
Malware.test <- subset(Malware.rm,sample==F)
Malware.train$Machine <- as.numeric(Malware.train$Machine)
Malware.test$Machine <- as.numeric(Malware.test$Machine)
any(is.na(Malware.train))
any(is.na(Malware.test))
Malware.test[is.na(Malware.test)] <- 0
dim(Malware.train)
dim(Malware.test)

# Model Building 
Model.log <- glm(legitimate~.,family = binomial(link = "logit"),Malware.train)
summary(Model.log)
# Prediction
fitted.probability <- predict(Model.log,Malware.test,type='response')
# Evaluation 
table (Malware.test$legitimate,fitted.probability>0.5)
acc <- (45597+23256)/75723
acc
err_rate <- (3700+3170)/75723
err_rate

# Model 2 (Random Forest)
Model.rf <- randomForest(legitimate~.,data=Malware.train)
